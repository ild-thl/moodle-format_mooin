function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("format_mooin4/ildhvp4",["jquery","core/ajax","core/notification","core/str","core/url","core/modal_factory","format_mooin4/mooin4Modal","format_mooin4/modalGenerator"],(function($,ajax,notification,Str,Url,ModalFactory,Mooin4Modal,generateModal){var ILD=ILD||{};return ILD.interactions=[],ILD.singleChoiceInteractions=[],ILD.subIds=[],ILD.questionSetPassPercentage=[],ILD.EssayPassPercentage=[],ILD.BranchingScenario=[],ILD.maxScore=0,ILD.score=0,ILD.percentage=0,ILD.xAPIAnsweredListener=function(event){var contentId=event.getVerifiedStatementValue(["object","definition","extensions","http://h5p.org/x-api/h5p-local-content-id"]),isInteraction=!1;if("Activity"==event.data.statement.object.objectType&&(isInteraction=!0),isInteraction&&"answered"===event.getVerb()&&void 0===ILD.questionSetPassPercentage[contentId]&&void 0===ILD.singleChoiceInteractions[contentId]&&void 0===ILD.EssayPassPercentage[contentId]&&void 0===ILD.BranchingScenario[contentId]){var score=event.getScore(),maxScore=event.getMaxScore(),subContentId=event.data.statement.object.id;if(subContentId=(subContentId=subContentId.split("subContentId="))[1],-1!=ILD.subIds.indexOf(subContentId)){void 0===ILD.interactions[contentId]&&(ILD.interactions[contentId]=1);var interactions=ILD.interactions[contentId];ILD.percentage=ILD.percentage+score/maxScore/interactions*100,ILD.setResult(contentId,ILD.percentage,100)}else if(-1==ILD.subIds.indexOf(subContentId)&&0==ILD.subIds.length){var percentage=score/maxScore*100;ILD.setResult(contentId,percentage,100)}}void 0!==ILD.questionSetPassPercentage[contentId]&&"completed"===event.getVerb()&&((percentage=(score=event.getScore())/(maxScore=event.getMaxScore())*100)>=ILD.questionSetPassPercentage[contentId]?ILD.setResult(contentId,100,100):ILD.setResult(contentId,percentage,100));if(void 0!==ILD.EssayPassPercentage[contentId]&&"scored"===event.getVerb()){percentage=(score=event.getScore())/(maxScore=event.getMaxScore())*100;ILD.setResult(contentId,percentage,100)}if(void 0!==ILD.singleChoiceInteractions[contentId]&&"completed"===event.getVerb()){percentage=(score=event.getScore())/(maxScore=event.getMaxScore())*100;ILD.setResult(contentId,percentage,100)}void 0!==ILD.BranchingScenario[contentId]&&"completed"===event.getVerb()&&ILD.setResult(contentId,100,100)},ILD.setResult=function(contentid,score,maxScore){ajax.call([{methodname:"format_mooin4_setgrade",args:{contentid:contentid,score:score,maxscore:maxScore}}])[0].done((function(data){var div_id=String("mooin4ection"+data.sectionid),text_div_id=String("mooin4ection-text-"+data.sectionid),percentage=Math.round(data.percentage),percentage_int=String(percentage+"%"),percentage_text=String(percentage+"% ");($("#"+div_id,window.parent.document).css("width",percentage_int),$("#"+text_div_id,window.parent.document).html(percentage_text),100===data.percentage)&&(window.parent.document.querySelector('[data-key="'.concat(data.sectionid,'"]')).classList.add("completed"),ajax.call([{methodname:"format_mooin4_check_completion_status",args:{section_id:Number(data.sectionid),isActivity:!0,course_already_completed:data.course_already_completed,chapter_already_completed:data.chapter_already_completed}}])[0].done((function(data){var message={action:"showModal",modal:{data:data}};window.top.postMessage(message,"*")})).fail())})).fail((function(){}))},ILD.getVideoInteractions=function(contentId,content){var interactions=content.interactiveVideo.assets.interactions,summaries=content.interactiveVideo.summary.task.params.summaries,notAllowedInteractions=["H5P.Text","H5P.Table","H5P.Link","H5P.Image","H5P.GoToQuestion","H5P.Nil","H5P.IVHotspot"],interactionsCounter=0;if("object"===_typeof(interactions)&&($.each(interactions,(function(i){var library=interactions[i].action.library,subid=interactions[i].action.subContentId,foundItem=!1;$.each(notAllowedInteractions,(function(j){library.indexOf(notAllowedInteractions[j])>-1&&(foundItem=!0)})),foundItem||(interactionsCounter++,ILD.subIds.push(subid))})),ILD.interactions[contentId]=interactionsCounter),(void 0===interactions||"object"===_typeof(interactions)&&0==interactionsCounter)&&($(".h5p-iframe")[0].contentWindow.onload=function(){$(".h5p-iframe")[0].contentWindow.H5P.instances[0].video.on("stateChange",(function(event){0===event.data&&ILD.setResult(contentId,100,100)}))}),summaries.length){var summary=!1;$.each(summaries,(function(s){if(void 0!==summaries[s].summary){var subId=content.interactiveVideo.summary.task.subContentId;ILD.subIds.push(subId),summary=!0}})),summary&&(ILD.interactions[contentId]=interactionsCounter+1)}},ILD.getSingleChoiceInteractions=function(contentId,content){var interactions=content.choices;$.each(interactions,(function(s){var subid=interactions[s].subContentId;ILD.subIds.push(subid)})),ILD.singleChoiceInteractions[contentId]=interactions.length},ILD.getQuestionSetPercentage=function(contentId,content){ILD.questionSetPassPercentage[contentId]=content.passPercentage},ILD.getEssayPercentage=function(contentId,content){ILD.EssayPassPercentage[contentId]=content.behaviour.percentagePassing},ILD.checkLibrary=function(){var contentId=$(".h5p-iframe.h5p-initialized").data("content-id");if(void 0!==contentId){var contentData=H5PIntegration.contents["cid-"+contentId],content=JSON.parse(contentData.jsonContent),library=contentData.library;library.indexOf("H5P.InteractiveVideo")>-1?ILD.getVideoInteractions(contentId,content):library.indexOf("H5P.QuestionSet")>-1?ILD.getQuestionSetPercentage(contentId,content):library.indexOf("H5P.SingleChoiceSet")>-1?ILD.getSingleChoiceInteractions(contentId,content):library.indexOf("H5P.Essay")>-1?ILD.getEssayPercentage(contentId,content):library.indexOf("H5P.BranchingScenario")>-1&&(ILD.BranchingScenario[contentId]=1)}},{init:function(){ILD.checkLibrary(),H5P.externalDispatcher.on("xAPI",ILD.xAPIAnsweredListener)}}}));

//# sourceMappingURL=ildhvp4.min.js.map