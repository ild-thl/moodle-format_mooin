define("format_mooin4/section_completion_handler",["exports","core/ajax","core/notification","core/str","core/modal_factory","format_mooin4/mooin4Modal","core/templates","core/url"],(function(_exports,_ajax,_notification,_str,_modal_factory,_mooin4Modal,_templates,_url){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_modal_factory=_interopRequireDefault(_modal_factory),_mooin4Modal=_interopRequireDefault(_mooin4Modal),_templates=_interopRequireDefault(_templates);var _ref2,Selectors_actions={buttonClicked:'[data-action="format_mooin4/section_completion_handler-button"]'},init=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(_ref){var section_id,progressbar,percentageText,navdrawerSection;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(section_id=_ref.section_id,!_ref.isLastSectionOfChapter){_context2.next=6;break}return _context2.next=4,_modal_factory.default.create({title:"Kapitelende erreicht",body:'<p>Du bist in der letzten Lektion dieses Kapitels angekommen!</p><i class="bi bi-star"></i>',footer:'<button type="button" class="mooin4-btn mooin4-btn-primary"data-action="hide">Schließen<i class="bi bi-x-circle-fill"></i></button>',type:_mooin4Modal.default.TYPE,scrollable:!1});case 4:_context2.sent.show();case 6:progressbar=document.getElementById("mooin4ection".concat(section_id)),percentageText=document.getElementById("mooin4ection-text-".concat(section_id)),navdrawerSection=document.querySelector('[data-key="'.concat(section_id,'"]')),document.addEventListener("click",(function(e){var _ref3;e.target.closest(Selectors_actions.buttonClicked)&&_ajax.default.call([{methodname:"format_mooin4_check_completion_status",args:{section_id:Number(section_id),isActivity:!1}}])[0].done((_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee(data){var footerContent;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,(0,_str.get_string)("page_read","format_mooin4");case 2:if(e.target.textContent=_context.sent,e.target.classList.add("completed"),navdrawerSection.classList.add("completed"),e.target.disabled=!0,progressbar.style.width="100%",percentageText.innerText="100% ",!data.show_chapter_modal){_context.next=17;break}return document.querySelector('[data-key="'.concat(data.chapter_id,'"]')).classList.add("completed"),footerContent="",footerContent=data.next_chapter<0?'<button type="button" class="mooin4-btn mooin4-btn-special"data-action="hide">Schließen<i class="bi bi-x-circle-fill"></i></button>':'<button type="button" class="mooin4-btn mooin4-btn-special"data-action="hide">Schließen<i class="bi bi-x-circle-fill"></i></button><a href="'+(0,_url.relativeUrl)("/course/view.php",{id:data.course_id,section:data.next_chapter})+'" class="mooin4-btn mooin4-btn-primary">Nächstes Kapitel</a>',_context.next=15,_modal_factory.default.create({title:"Kapitel vollständig bearbeitet",body:'<p>Du hast alle Lektionen in diesem Kapitel bearbeitet!</p><i class="bi bi-check-circle"></i>',footer:footerContent,type:_mooin4Modal.default.TYPE,scrollable:!1});case 15:_context.sent.show();case 17:if(window.console.log(data.show_course_modal),!data.show_course_modal){_context.next=25;break}return document.querySelector('[data-key="'.concat(data.chapter_id,'"]')).classList.add("completed"),_context.next=23,_modal_factory.default.create({title:"Kurs vollständig bearbeitet",body:'<p>Du hast alle Lektionen in diesem Kurs bearbeitet!</p><i class="bi bi-mortarboard-fill"></i>',footer:'<button type="button" class="mooin4-btn mooin4-btn-special"data-action="hide">Schließen<i class="bi bi-x-circle-fill"></i></button>',type:_mooin4Modal.default.TYPE,scrollable:!1});case 23:_context.sent.show();case 25:case"end":return _context.stop()}}),_callee)}))),function(_x2){return _ref3.apply(this,arguments)})).fail()}));case 10:case"end":return _context2.stop()}}),_callee2)}))),function(_x){return _ref2.apply(this,arguments)});_exports.init=init}));

//# sourceMappingURL=section_completion_handler.min.js.map