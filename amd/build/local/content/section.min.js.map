{"version":3,"file":"section.min.js","sources":["../../../src/local/content/section.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Course section format component.\r\n *\r\n * @module     core_courseformat/local/content/section\r\n * @class      core_courseformat/local/content/section\r\n * @copyright  2021 Ferran Recio <ferran@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Header from \"format_mooin4/local/content/section/header\";\r\nimport DndSection from \"format_mooin4/local/courseeditor/dndsection\";\r\nimport Templates from \"core/templates\";\r\nimport ModalFactory from \"core/modal_factory\";\r\nimport Mooin4Modal from \"../../mooin4modal\";\r\nimport { get_string as getString } from \"core/str\";\r\nimport ILD from \"format_mooin4/ildhvp4\";\r\n\r\nexport default class extends DndSection {\r\n  /**\r\n   * Constructor hook.\r\n   */\r\n  create() {\r\n    // Optional component name for debugging.\r\n    this.name = \"content_section\";\r\n    // Default query selectors.\r\n    this.selectors = {\r\n      SECTION_ITEM: `[data-for='section_title']`,\r\n      CM: `[data-for=\"cmitem\"]`,\r\n      SECTIONINFO: `[data-for=\"sectioninfo\"]`,\r\n      SECTIONBADGES: `[data-region=\"sectionbadges\"]`,\r\n      SHOWSECTION: `[data-action=\"sectionShow\"]`,\r\n      HIDESECTION: `[data-action=\"sectionHide\"]`,\r\n      SETCHAPTER: `[data-action=\"sectionSetChapter\"]`,\r\n      UNSETCHAPTER: `[data-action=\"sectionUnsetChapter\"]`,\r\n      ACTIONTEXT: `.menu-action-text`,\r\n      ICON: `.icon`,\r\n      H5P: `.parent-iframe`,\r\n    };\r\n    // Most classes will be loaded later by DndCmItem.\r\n    this.classes = {\r\n      LOCKED: \"editinprogress\",\r\n      HASDESCRIPTION: \"description\",\r\n      HIDE: \"d-none\",\r\n      HIDDEN: \"hidden\",\r\n      CHAPTER: \"chapter\",\r\n    };\r\n\r\n    // We need our id to watch specific events.\r\n    this.id = this.element.dataset.id;\r\n  }\r\n\r\n  /**\r\n   * Initial state ready method.\r\n   *\r\n   * @param {Object} state the initial state\r\n   */\r\n  stateReady(state) {\r\n    this.configState(state);\r\n    // Drag and drop is only available for components compatible course formats.\r\n    if (this.reactive.isEditing && this.reactive.supportComponents) {\r\n      // Section zero and other formats sections may not have a title to drag.\r\n      const sectionItem = this.getElement(this.selectors.SECTION_ITEM);\r\n      if (sectionItem) {\r\n        // Init the inner dragable element.\r\n        const headerComponent = new Header({\r\n          ...this,\r\n          element: sectionItem,\r\n          fullregion: this.element,\r\n        });\r\n        this.configDragDrop(headerComponent);\r\n      }\r\n    }\r\n    this._showLastSectionModal(state);\r\n    this._hvpListener();\r\n  }\r\n\r\n  /**\r\n   * Component watchers.\r\n   *\r\n   * @returns {Array} of watchers\r\n   */\r\n  getWatchers() {\r\n    return [\r\n      { watch: `section[${this.id}]:updated`, handler: this._refreshSection },\r\n      // {watch: `section[${this.id}].sectionprogress:updated`, handler: this._updateSectionProgress}\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Validate if the drop data can be dropped over the component.\r\n   *\r\n   * @param {Object} dropdata the exported drop data.\r\n   * @returns {boolean}\r\n   */\r\n  validateDropData(dropdata) {\r\n    // If the format uses one section per page sections dropping in the content is ignored.\r\n    if (dropdata?.type === \"section\" && this.reactive.sectionReturn != 0) {\r\n      return false;\r\n    }\r\n    return super.validateDropData(dropdata);\r\n  }\r\n\r\n  /**\r\n   * Get the last CM element of that section.\r\n   *\r\n   * @returns {element|null}\r\n   */\r\n  getLastCm() {\r\n    const cms = this.getElements(this.selectors.CM);\r\n    // DndUpload may add extra elements so :last-child selector cannot be used.\r\n    if (!cms || cms.length === 0) {\r\n      return null;\r\n    }\r\n    return cms[cms.length - 1];\r\n  }\r\n\r\n  /**\r\n   * Update a content section using the state information.\r\n   *\r\n   * @param {object} param\r\n   * @param {Object} param.element details the update details.\r\n   */\r\n  _refreshSection({ element }) {\r\n    // Update classes.\r\n    this.element.classList.toggle(\r\n      this.classes.DRAGGING,\r\n      element.dragging ?? false\r\n    );\r\n    this.element.classList.toggle(this.classes.LOCKED, element.locked ?? false);\r\n    this.element.classList.toggle(\r\n      this.classes.HIDDEN,\r\n      !element.visible ?? false\r\n    );\r\n    this.element.classList.toggle(\r\n      this.classes.CHAPTER,\r\n      element.isChapter ?? false\r\n    );\r\n    this.locked = element.locked;\r\n    // The description box classes depends on the section state.\r\n    const sectioninfo = this.getElement(this.selectors.SECTIONINFO);\r\n    if (sectioninfo) {\r\n      sectioninfo.classList.toggle(\r\n        this.classes.HASDESCRIPTION,\r\n        element.hasrestrictions\r\n      );\r\n    }\r\n    // Update section badges and menus.\r\n    this._updateBadges(element);\r\n    this._updateActionsMenu(element);\r\n\r\n    if (this.reactive.isEditing) {\r\n      //this._reloadSectionNames({ element: element });\r\n    }\r\n  }\r\n\r\n  async _reloadSectionNames({ element }) {\r\n    const title = this.getElement(this.selectors.SECTION_ITEM);\r\n    //window.console.log(element);\r\n    if (!element.isChapter) {\r\n      //title.innerHTML = element.parentChapter + \".\" + element.innerChapterNumber + \": \" + element.title;\r\n      title.innerHTML = element.prefix;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a section badges using the state information.\r\n   *\r\n   * @param {object} section the section state.\r\n   */\r\n  _updateBadges(section) {\r\n    const current = this.getElement(\r\n      `${this.selectors.SECTIONBADGES} [data-type='iscurrent']`\r\n    );\r\n    current?.classList.toggle(this.classes.HIDE, !section.current);\r\n\r\n    const hiddenFromStudents = this.getElement(\r\n      `${this.selectors.SECTIONBADGES} [data-type='hiddenfromstudents']`\r\n    );\r\n    hiddenFromStudents?.classList.toggle(this.classes.HIDE, section.visible);\r\n  }\r\n\r\n  /**\r\n   * Update a section action menus.\r\n   *\r\n   * @param {object} section the section state.\r\n   */\r\n  async _updateActionsMenu(section) {\r\n    let selector;\r\n    let newAction;\r\n    if (section.visible) {\r\n      selector = this.selectors.SHOWSECTION;\r\n      newAction = \"sectionHide\";\r\n    } else {\r\n      selector = this.selectors.HIDESECTION;\r\n      newAction = \"sectionShow\";\r\n    }\r\n\r\n    if (section.isChapter) {\r\n      selector = this.selectors.SETCHAPTER;\r\n      newAction = \"sectionUnsetChapter\";\r\n    } else {\r\n      selector = this.selectors.UNSETCHAPTER;\r\n      newAction = \"sectionSetChapter\";\r\n    }\r\n\r\n    // Find the affected action.\r\n    const affectedAction = this.getElement(selector);\r\n    if (!affectedAction) {\r\n      return;\r\n    }\r\n    // Change action.\r\n    affectedAction.dataset.action = newAction;\r\n    // Change text.\r\n    const actionText = affectedAction.querySelector(this.selectors.ACTIONTEXT);\r\n    if (affectedAction.dataset?.swapname && actionText) {\r\n      const oldText = actionText?.innerText;\r\n      actionText.innerText = affectedAction.dataset.swapname;\r\n      affectedAction.dataset.swapname = oldText;\r\n    }\r\n    // Change icon.\r\n    const icon = affectedAction.querySelector(this.selectors.ICON);\r\n    if (affectedAction.dataset?.swapicon && icon) {\r\n      const newIcon = affectedAction.dataset.swapicon;\r\n      if (newIcon) {\r\n        const pixHtml = await Templates.renderPix(newIcon, \"core\");\r\n        Templates.replaceNode(icon, pixHtml, \"\");\r\n      }\r\n    }\r\n  }\r\n\r\n  async _showLastSectionModal(state) {\r\n    const section = state.section.get(this.id);\r\n    if (\r\n      section.showLastSectionModal &&\r\n      window.location.href == section.sectionurl.replace(/&amp;/g, \"&\")\r\n    ) {\r\n      const modal = await ModalFactory.create({\r\n        type: Mooin4Modal.TYPE,\r\n        title: await getString(\r\n          \"modal_last_section_of_chapter_title\",\r\n          \"format_mooin4\"\r\n        ),\r\n        body: Templates.render(\r\n          \"format_mooin4/local/content/modals/lastsection\",\r\n          {}\r\n        ),\r\n        footer: Templates.render(\r\n          \"format_mooin4/local/content/modals/modalfooterclose\",\r\n          {}\r\n        ),\r\n        scrollable: false,\r\n      });\r\n      modal.show();\r\n      modal.showFooter();\r\n      this.reactive.dispatch(\"setLastSectionModal\", this.id);\r\n    }\r\n  }\r\n\r\n  _hvpListener() {\r\n    var h5p_contentIds = [];\r\n    var parentIFrames = this.getElements(this.selectors.H5P);\r\n    //console.log(\"Anzahl der parentIFrames gefunden:\", parentIFrames.length);\r\n    if (parentIFrames.length > 0) {\r\n      parentIFrames.forEach((parentIFrame) => {\r\n        if (parentIFrame.contentDocument) {\r\n          var parentIFrameContent =\r\n            parentIFrame.contentDocument || parentIFrame.contentWindow.document;\r\n          //console.log(\"parentIFrameContent gefunden:\", parentIFrameContent);\r\n\r\n          let nestedIFrame = null;\r\n\r\n          const adjustParentIFrameHeight = () => {\r\n            setTimeout(() => {\r\n              console.log(\"adjustParentIFrameHeight\");\r\n\r\n              if (nestedIFrame && nestedIFrame.contentWindow.document.body) {\r\n                const nestedIFrameHeight =\r\n                  nestedIFrame.contentWindow.document.body.scrollHeight;\r\n                if (nestedIFrameHeight > 1) {\r\n                  parentIFrame.style.height = nestedIFrameHeight + \"px\";\r\n                  // console.log(\r\n                  //     \"ParentIFrame-Höhe angepasst:\",\r\n                  //     nestedIFrameHeight + \"px\"\r\n                  // );\r\n                } else {\r\n                  //console.log(\"Inhalt noch nicht vollständig gerendert, Höhe nicht angepasst.\");\r\n                }\r\n              } else {\r\n                //console.log(\"Body ist noch nicht verfügbar.\");\r\n              }\r\n            }, 100);\r\n          };\r\n\r\n          const monitorElementLoads = () => {\r\n            console.log(\"monitorElementLoads\");\r\n\r\n            // Überwache das Laden von Bildern, Videos und anderen Medien im iframe\r\n            const elementsToWatch = ['img', 'video', 'iframe', 'embed', 'object'];\r\n            elementsToWatch.forEach(tag => {\r\n              const elements = nestedIFrame.contentDocument.getElementsByTagName(tag);\r\n              for (let element of elements) {\r\n                element.addEventListener('load', adjustParentIFrameHeight);\r\n                element.addEventListener('resize', adjustParentIFrameHeight);\r\n              }\r\n            });\r\n          };\r\n\r\n          const checkForH5P = () => {\r\n            console.log(\"checkForH5P\");\r\n            if (nestedIFrame) {\r\n              var H5PIntegration = nestedIFrame.contentWindow.H5PIntegration;\r\n              var H5P = nestedIFrame.contentWindow.H5P;\r\n              if (H5P && H5P.externalDispatcher) {\r\n                //console.log(\"H5P-Objekt gefunden.\");\r\n\r\n                //workaround for problem, that several observer regard the same object\r\n                function addUniqueH5PcontentId(array, element) {\r\n                  if (!array.includes(element)) {\r\n                    array.push(element);\r\n                  }\r\n                  return array;\r\n                }\r\n\r\n                //array of h5p contentId\r\n\r\n                H5P.setFinished = function (contentId, score, maxScore, time) {\r\n                  // H5P-Funktion hijacken, damit die Grade nicht doppelt eingetragen wird\r\n                };\r\n\r\n                //H5P.externalDispatcher.on(\"xAPI\", this._hvpprogress.bind(this));\r\n                //ILD.checkLibrary();\r\n                //H5P.externalDispatcher.on(\"xAPI\", ILD.xAPIAnsweredListener);\r\n                if (!h5p_contentIds.includes(H5P.instances[0].contentId)) {\r\n                  var current_array = addUniqueH5PcontentId(h5p_contentIds, H5P.instances[0].contentId);\r\n                  ILD.init(H5P, H5PIntegration, this.id, this.reactive);\r\n                }\r\n                //window.console.log(H5P);\r\n\r\n                adjustParentIFrameHeight(); // Höhe sofort anpassen, wenn H5P gefunden wird\r\n\r\n                // Starte den MutationObserver\r\n                var observer = new MutationObserver(function (mutations) {\r\n                  mutations.forEach(function (mutation) {\r\n                    if (mutation.addedNodes.length > 0 || mutation.attributeName === 'src') {\r\n                      // console.log(\r\n                      //     \"DOM-Änderung oder Attributänderung erkannt im .h5p-iframe: \",\r\n                      //     mutation\r\n                      // );\r\n                      adjustParentIFrameHeight(); // Passe die Höhe nach der Mutation oder Attributänderung an\r\n                    }\r\n                  });\r\n                });\r\n\r\n                observer.observe(nestedIFrame.contentDocument, {\r\n                  childList: true,\r\n                  subtree: true,\r\n                  attributes: true, // Überwacht Änderungen an Attributen wie `src`\r\n                });\r\n                // console.log(\r\n                //     \"MutationObserver wurde gestartet, um Änderungen im .h5p-iframe zu überwachen.\"\r\n                // );\r\n\r\n                return true; // H5P wurde gefunden und alles eingerichtet\r\n              }\r\n            }\r\n            return false; // H5P wurde noch nicht gefunden oder nestedIFrame ist nicht verfügbar\r\n          };\r\n\r\n          const checkForNestedIFrame = () => {\r\n            nestedIFrame = parentIFrameContent.querySelector(\".h5p-iframe\");\r\n            //console.log(\"nestedIFrame gefunden:\", nestedIFrame);\r\n\r\n            if (nestedIFrame) {\r\n              // Füge ein 'load' Event hinzu\r\n              nestedIFrame.addEventListener('load', function () {\r\n                //console.log('.h5p-iframe vollständig geladen.');\r\n                adjustParentIFrameHeight(); // Passe die Höhe an, wenn das iframe vollständig geladen ist\r\n                checkForH5P(); // Prüfe H5P erneut nach dem Laden\r\n                monitorElementLoads(); // Überwache das Laden von Elementen\r\n              });\r\n\r\n              // Fallback: Sofortiger Versuch, H5P zu finden\r\n              if (!checkForH5P()) {\r\n                //console.log(\"H5P wurde nicht gefunden, starte Überwachung.\");\r\n\r\n                // Fallback: Regelmäßige Überprüfung des Inhalts (Polling) für H5P\r\n                var h5pCheckInterval = setInterval(function () {\r\n                  if (checkForH5P()) {\r\n                    clearInterval(h5pCheckInterval); // Stoppe das Intervall, wenn H5P gefunden wurde\r\n                  }\r\n                }, 500); // Überprüft alle 500ms\r\n              }\r\n\r\n              return true; // nestedIFrame wurde gefunden, keine weitere Aktion erforderlich\r\n            }\r\n            return false; // nestedIFrame wurde noch nicht gefunden\r\n          };\r\n\r\n          // Initialer Versuch, nestedIFrame zu finden\r\n          if (!checkForNestedIFrame()) {\r\n            // console.log(\r\n            //     \"nestedIFrame wurde nicht gefunden, starte Beobachtung des parentIFrame.\"\r\n            // );\r\n\r\n            // Beobachte den parentIFrame für das Erscheinen des nestedIFrame\r\n            var observer = new MutationObserver(function (mutations) {\r\n              console.log(\"_hvpListener 7\");\r\n\r\n              mutations.forEach(function (mutation) {\r\n                if (mutation.addedNodes.length > 0) {\r\n                  // console.log(\r\n                  //     \"Eine neue Node wurde hinzugefügt:\",\r\n                  //     mutation.addedNodes\r\n                  // );\r\n                  if (checkForNestedIFrame()) {\r\n                    observer.disconnect(); // Stoppe das Beobachten, nachdem nestedIFrame gefunden wurde\r\n                  }\r\n                }\r\n              });\r\n            });\r\n\r\n            observer.observe(parentIFrameContent, {\r\n              childList: true,\r\n              subtree: true,\r\n            });\r\n          }\r\n        } else {\r\n          //console.error(\"Kein Dokument im parentIFrame gefunden.\");\r\n        }\r\n      });\r\n    } else {\r\n      //console.error(\"Keine parentIFrames gefunden.\");\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n  // _hvpListener() {\r\n  //   var parentIFrames = this.getElements(this.selectors.H5P);\r\n  //   if (parentIFrames.length > 0) {\r\n  //     parentIFrames.forEach((parentIFrame) => {\r\n  //       if (parentIFrame.contentDocument) {\r\n  //         var parentIFrameContent =\r\n  //           parentIFrame.contentDocument || parentIFrame.contentWindow.document;\r\n\r\n  //         var nestedIFrame = parentIFrameContent.querySelector(\".h5p-iframe\");\r\n\r\n  //         if (nestedIFrame) {\r\n  //           var H5P = nestedIFrame.contentWindow.H5P;\r\n  //           if (H5P && H5P.externalDispatcher) {\r\n\r\n  //             // var nestedIFrameHeight =\r\n  //             // nestedIFrame.contentWindow.document.body.scrollHeight;\r\n  //             // parentIFrame.style.height = nestedIFrameHeight + \"px\";\r\n  //             //ILD.init(H5P);\r\n  //             window.console.log(H5P);\r\n\r\n  //             H5P.setFinished = function (contentId, score, maxScore, time) {\r\n  //              //hvp Funktion hijacken, damit die Grade nicht doppelt eingetragen wird\r\n  //             };\r\n  //             H5P.externalDispatcher.on(\"xAPI\", this._hvpprogress.bind(this));\r\n  //             var instance = H5P.instances[0];\r\n  //             H5P.trigger(instance, 'resize');\r\n  // var nestedIFrameHeight =\r\n  // nestedIFrame.contentWindow.document.body.scrollHeight;\r\n  // parentIFrame.style.height = nestedIFrameHeight + \"px\";\r\n  //           } else {\r\n  //             setTimeout(this._hvpListener.bind(this), 50);\r\n  //           }\r\n  //         } else {\r\n  //           setTimeout(this._hvpListener.bind(this), 50);\r\n  //         }\r\n  //       } else {\r\n  //         setTimeout(this._hvpListener.bind(this), 50);\r\n  //       }\r\n  //     });\r\n  //   }\r\n  // }\r\n\r\n  _hvpprogress(event) {\r\n    window.console.log(event);\r\n\r\n    if (event.getVerb() === \"completed\" || event.getVerb() === \"answered\") {\r\n      var contentId = event.getVerifiedStatementValue([\r\n        \"object\",\r\n        \"definition\",\r\n        \"extensions\",\r\n        \"http://h5p.org/x-api/h5p-local-content-id\",\r\n      ]);\r\n      var score = event.getScore();\r\n      var maxScore = event.getMaxScore();\r\n      var statement = event.data.statement;\r\n      var isChild =\r\n        statement.context &&\r\n        statement.context.contextActivities &&\r\n        statement.context.contextActivities.parent &&\r\n        statement.context.contextActivities.parent[0] &&\r\n        statement.context.contextActivities.parent[0].id;\r\n\r\n\r\n      this.reactive.dispatch(\r\n        \"updateSectionprogress\",\r\n        this.id,\r\n        contentId,\r\n        score,\r\n        maxScore\r\n      );\r\n\r\n    }\r\n  }\r\n}\r\n"],"names":["DndSection","create","name","selectors","SECTION_ITEM","CM","SECTIONINFO","SECTIONBADGES","SHOWSECTION","HIDESECTION","SETCHAPTER","UNSETCHAPTER","ACTIONTEXT","ICON","H5P","classes","LOCKED","HASDESCRIPTION","HIDE","HIDDEN","CHAPTER","id","this","element","dataset","stateReady","state","configState","reactive","isEditing","supportComponents","sectionItem","getElement","headerComponent","Header","fullregion","configDragDrop","_showLastSectionModal","_hvpListener","getWatchers","watch","handler","_refreshSection","validateDropData","dropdata","type","sectionReturn","super","getLastCm","cms","getElements","length","classList","toggle","DRAGGING","dragging","locked","visible","isChapter","sectioninfo","hasrestrictions","_updateBadges","_updateActionsMenu","title","innerHTML","prefix","section","current","hiddenFromStudents","selector","newAction","affectedAction","action","actionText","querySelector","swapname","oldText","innerText","icon","swapicon","newIcon","pixHtml","Templates","renderPix","replaceNode","get","showLastSectionModal","window","location","href","sectionurl","replace","modal","ModalFactory","Mooin4Modal","TYPE","body","render","footer","scrollable","show","showFooter","dispatch","h5p_contentIds","parentIFrames","forEach","parentIFrame","contentDocument","parentIFrameContent","contentWindow","document","nestedIFrame","adjustParentIFrameHeight","setTimeout","console","log","nestedIFrameHeight","scrollHeight","style","height","monitorElementLoads","tag","elements","getElementsByTagName","addEventListener","checkForH5P","H5PIntegration","externalDispatcher","setFinished","contentId","score","maxScore","time","includes","instances","array","push","init","MutationObserver","mutations","mutation","addedNodes","attributeName","observe","childList","subtree","attributes","checkForNestedIFrame","h5pCheckInterval","setInterval","clearInterval","observer","disconnect","_hvpprogress","event","getVerb","getVerifiedStatementValue","getScore","getMaxScore","statement","data","context","contextActivities","parent"],"mappings":"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"}