{"version":3,"file":"custommutations.min.js","sources":["../../../src/local/courseeditor/custommutations.js"],"sourcesContent":["import ajax from 'core/ajax';\r\n\r\nexport default class {\r\n    \r\n\r\n    async completeSection(stateManager, target) {\r\n        const course = stateManager.get('course');\r\n        let ids = [];\r\n        ids.push(target.dataset.id);\r\n        const args = {\r\n            action: 'complete_section',\r\n            courseid: course.id,\r\n            ids: ids,\r\n            targetsectionid: target.dataset.id,\r\n        };\r\n        let updates = await ajax.call([{\r\n            methodname: 'core_courseformat_update_course',\r\n            args,\r\n        }])[0];\r\n        stateManager.processUpdates(JSON.parse(updates));\r\n    }\r\n\r\n    async updateSectionprogress(stateManager, sectionId, contentid, score, maxscore) {\r\n\r\n        await ajax.call([\r\n            {\r\n              methodname: \"format_mooin4_setgrade\",\r\n              args: { contentid: contentid, score: score, maxscore: maxscore },\r\n            },\r\n          ])[0];  \r\n\r\n\r\n        const course = stateManager.get('course');\r\n        let ids = [];\r\n        ids.push(sectionId);\r\n        const args = {\r\n            action: 'update_sectionprogress',\r\n            courseid: course.id,\r\n            ids: ids,\r\n            targetsectionid: sectionId,\r\n        };\r\n        let updates = await ajax.call([{\r\n            methodname: 'core_courseformat_update_course',\r\n            args\r\n        }])[0];\r\n        window.console.log(\"MUTAtION PROGRESS\");\r\n        stateManager.processUpdates(JSON.parse(updates));\r\n    }\r\n\r\n    async sectionSetChapter(stateManager, target) {\r\n        const course = stateManager.get('course');\r\n        let ids = [];\r\n        const targetSection = stateManager.state.section.get(target.dataset.id);\r\n        ids.push(target.dataset.id);\r\n        // stateManager.state.section.forEach(section => {\r\n        //     if (section.number >= targetSection.number) {\r\n        //         ids.push(section.id);\r\n        //     }\r\n        // });\r\n        \r\n        \r\n        const args = {\r\n            action: 'section_setChapter',\r\n            courseid: course.id,\r\n            ids: ids,\r\n            targetsectionid: target.dataset.id,\r\n        };\r\n        let updates = await ajax.call([{\r\n            methodname: 'core_courseformat_update_course',\r\n            args,\r\n        }])[0];\r\n        stateManager.processUpdates(JSON.parse(updates));\r\n        stateManager.setReadOnly(false);\r\n\r\n        let lastChapter = stateManager.state.section.get(target.dataset.id);\r\n        let invisbleCounter = 0\r\n\r\n        stateManager.state.section.forEach(section => {\r\n            if (section.number > targetSection.number) {\r\n                //statesection = state.section.get(section.id)\r\n                if (section.isChapter) {\r\n                    lastChapter = section;  // Das aktuelle Chapter zwischenspeichern\r\n                    section.isChapter++;\r\n                    invisbleCounter = 0\r\n                } else if (section.isChapter == false) {\r\n                    \r\n                        section.parentChapter = lastChapter.isChapter;\r\n                        section.innerChapterNumber = section.number - lastChapter.number - invisbleCounter;\r\n                        if (section.visible) {\r\n                            section.prefix = section.parentChapter + \".\" + section.innerChapterNumber;\r\n                        } else {\r\n                            invisbleCounter++\r\n                        }\r\n                        \r\n                        \r\n                    \r\n                }\r\n            }\r\n        });\r\n        stateManager.setReadOnly(true);\r\n        \r\n    }\r\n    async sectionUnsetChapter(stateManager, target) {\r\n        const course = stateManager.get('course');\r\n        let ids = [];\r\n        const targetSection = stateManager.state.section.get(target.dataset.id);\r\n        ids.push(target.dataset.id);\r\n        // const targetSection = stateManager.state.section.get(target.dataset.id);\r\n        // stateManager.state.section.forEach(section => {\r\n        //     if (section.number >= targetSection.number) {\r\n        //         ids.push(section.id);\r\n        //     }\r\n        // });\r\n        \r\n        const args = {\r\n            action: 'section_unsetChapter',\r\n            courseid: course.id,\r\n            ids: ids,\r\n            targetsectionid: target.dataset.id,\r\n        };\r\n        let updates = await ajax.call([{\r\n            methodname: 'core_courseformat_update_course',\r\n            args,\r\n        }])[0];\r\n        \r\n\r\n        stateManager.setReadOnly(false);\r\n\r\n        let lastChapter = stateManager.state.section.get(target.dataset.id);\r\n        let prevChapter = lastChapter.isChapter -1;\r\n\r\n        stateManager.state.section.forEach(section => {\r\n            window.console.log(prevChapter);\r\n            window.console.log(section.isChapter);\r\n            if (section.isChapter == prevChapter) {\r\n                lastChapter = section;\r\n            }\r\n        });\r\n\r\n        let invisbleCounter = 0\r\n\r\n        stateManager.state.section.forEach(section => {\r\n            if (section.number > targetSection.number) {\r\n                //statesection = state.section.get(section.id)\r\n                if (section.isChapter && section.isChapter != 1) {\r\n                    lastChapter = section;\r\n                    section.isChapter--;\r\n                    invisbleCounter = 0\r\n                } else if (section.isChapter == false) {\r\n                    \r\n                        section.parentChapter = lastChapter.isChapter;\r\n                        section.innerChapterNumber = section.number - lastChapter.number - invisbleCounter;\r\n                        if (section.visible) {\r\n                            section.prefix = section.parentChapter + \".\" + section.innerChapterNumber;\r\n                        } else {\r\n                            invisbleCounter++\r\n                        } \r\n                }\r\n            }\r\n        });\r\n        stateManager.setReadOnly(true);\r\n        stateManager.processUpdates(JSON.parse(updates));\r\n        \r\n    }\r\n\r\n    async setLastSectionModal(stateManager, id) {\r\n        const course = stateManager.get('course');\r\n        let ids = [];\r\n        ids.push(id);\r\n        const args = {\r\n            action: 'set_last_section_modal',\r\n            courseid: course.id,\r\n            ids: ids,\r\n            targetsectionid: id,\r\n        };\r\n        let updates = await ajax.call([{\r\n            methodname: 'core_courseformat_update_course',\r\n            args,\r\n        }])[0];\r\n        stateManager.processUpdates(JSON.parse(updates));\r\n    }\r\n\r\n    setContinueSection(stateManager, type, id) {\r\n        stateManager.setReadOnly(false);\r\n        const state = stateManager.state;\r\n        const course = state.course;\r\n        course.continueSection = id;\r\n        state.section.forEach((section) => {\r\n            //section.containsActiveSection = false;\r\n            //section.isActiveSection = false;\r\n            if (section.id == id) {\r\n                section.isActiveSection = true;\r\n            }\r\n            \r\n            if (section.parentChapter == state.section.get(id).parentChapter) {\r\n                section.containsActiveSection = true;\r\n                \r\n            }\r\n        });\r\n        state.section.get(id).isActiveSection = true;\r\n        \r\n        stateManager.setReadOnly(true);\r\n    }\r\n\r\n    async getContinueSection(stateManager, target) {\r\n        const state = stateManager.state;\r\n        const course = state.course;\r\n        const args = {\r\n            action: 'getContinuesection',\r\n            courseid: course.id,\r\n        };\r\n        let updates = await ajax.call([{\r\n            methodname: 'core_courseformat_update_course',\r\n            args,\r\n        }])[0];\r\n        stateManager.processUpdates(JSON.parse(updates));\r\n    }\r\n\r\n    async readAllForumDiscussions(stateManager, forumid) {\r\n        const state = stateManager.state;\r\n        const course = state.course;\r\n        let ids = [];\r\n        ids.push(forumid);\r\n        const args = {\r\n            action: 'readAllForumDiscussions',\r\n            courseid: course.id,\r\n            ids: ids,\r\n        }\r\n        let updates = await ajax.call([{\r\n            methodname: 'core_courseformat_update_course',\r\n            args,\r\n        }])[0];\r\n        stateManager.processUpdates(JSON.parse(updates));\r\n    }\r\n\r\n    async reloadAllSectionPrefixes(stateManager, target) {\r\n        const state = stateManager.state;\r\n        const course = state.course;\r\n        let ids = [];\r\n        stateManager.state.section.forEach(section => {\r\n            // if (section.number >= target.number) {\r\n                ids.push(section.id);\r\n            // }\r\n        });\r\n        //ids.push(target); \r\n        const args = {\r\n            action: 'reload_all_section_prefixes',\r\n            courseid: course.id,\r\n            ids: ids,\r\n        }\r\n        let updates = await ajax.call([{\r\n            methodname: 'core_courseformat_update_course',\r\n            args,\r\n        }])[0];\r\n        stateManager.processUpdates(JSON.parse(updates));\r\n    }\r\n}"],"names":["stateManager","target","course","get","ids","push","dataset","id","args","action","courseid","targetsectionid","updates","ajax","call","methodname","processUpdates","JSON","parse","sectionId","contentid","score","maxscore","window","console","log","targetSection","state","section","setReadOnly","lastChapter","invisbleCounter","forEach","number","isChapter","parentChapter","innerChapterNumber","visible","prefix","prevChapter","setContinueSection","type","continueSection","isActiveSection","containsActiveSection","forumid"],"mappings":"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"}