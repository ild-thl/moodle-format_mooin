{"version":3,"file":"section_completion_handler.min.js","sources":["../src/section_completion_handler.js"],"sourcesContent":["import Ajax from \"core/ajax\";\nimport Notification from \"core/notification\";\nimport { get_string as getString } from \"core/str\";\nimport ModalFactory from \"core/modal_factory\";\nimport Mooin4Modal from \"format_mooin4/mooin4Modal\";\nimport Templates from \"core/templates\";\nimport { relativeUrl } from \"core/url\";\n\nconst Selectors = {\n  actions: {\n    buttonClicked:\n      '[data-action=\"format_mooin4/section_completion_handler-button\"]',\n  },\n};\n\nexport const init = async ({\n  section_id,\n  isLastSectionOfChapter,\n  courseCompletedAlready,\n}) => {\n  if (isLastSectionOfChapter) {\n    const modal = await ModalFactory.create({\n      title: await getString(\n        \"modal_last_section_of_chapter_title\",\n        \"format_mooin4\"\n      ),\n      body:\n        \"<p>\" +\n        (await getString(\"modal_last_section_of_chapter\", \"format_mooin4\")) +\n        '</p><i class=\"bi bi-star\"></i>',\n      footer:\n        '<button type=\"button\" class=\"mooin4-btn mooin4-btn-primary\"' +\n        'data-action=\"hide\">' +\n        (await getString(\"close\", \"format_mooin4\")) +\n        '<i class=\"bi bi-x-circle-fill\"></i></button>',\n      type: Mooin4Modal.TYPE,\n      scrollable: false,\n    });\n    modal.show();\n  }\n\n  let progressbar = document.getElementById(`mooin4ection${section_id}`);\n  let percentageText = document.getElementById(\n    `mooin4ection-text-${section_id}`\n  );\n  let navdrawerSection = document.querySelector(`[data-key=\"${section_id}\"]`);\n\n  document.addEventListener(\"click\", (e) => {\n    if (e.target.closest(Selectors.actions.buttonClicked)) {\n      var promises = Ajax.call([\n        {\n          methodname: \"format_mooin4_check_completion_status\",\n          args: {\n            section_id: Number(section_id),\n            isActivity: false,\n            course_already_completed: courseCompletedAlready,\n            chapter_already_completed: false,\n          },\n        },\n      ]);\n      promises[0]\n        .done(async function (data) {\n          e.target.textContent = await getString(\"page_read\", \"format_mooin4\");\n\n          e.target.classList.add(\"completed\");\n          navdrawerSection.classList.add(\"completed\");\n          e.target.disabled = true;\n          progressbar.style.width = \"100%\";\n          percentageText.innerText = \"100%\" + \" \";\n\n          var message = {\n            action: \"showModal\",\n            modal: { data },\n          };\n          window.postMessage(message, \"*\");\n\n          // if (data.show_chapter_modal) {\n          //   let navdrawerChapter = document.querySelector(\n          //     `[data-key=\"${data.chapter_id}\"]`\n          //   );\n          //   navdrawerChapter.classList.add(\"completed\");\n          //   var footerContent = \"\";\n          //   if (data.next_chapter < 0) {\n          //      footerContent =\n          //       '<button type=\"button\" class=\"mooin4-btn mooin4-btn-special\"' +\n          //        'data-action=\"hide\">Schließen<i class=\"bi bi-x-circle-fill\"></i></button>';\n          //   } else {\n          //      footerContent =\n          //       '<button type=\"button\" class=\"mooin4-btn mooin4-btn-special\"' +\n          //        'data-action=\"hide\">Schließen<i class=\"bi bi-x-circle-fill\"></i></button>' +\n          //       '<a href=\"' +\n          //       relativeUrl(\"/course/view.php\", {\n          //         id: data.course_id,\n          //         section: data.next_chapter,\n          //       }) +\n          //       '\" class=\"mooin4-btn mooin4-btn-primary\">Nächstes Kapitel</a>';\n          //   }\n          //   const modal = await ModalFactory.create({\n          //     title: \"Kapitel vollständig bearbeitet\",\n          //     body: '<p>Du hast alle Lektionen in diesem Kapitel bearbeitet!</p><i class=\"bi bi-check-circle\"></i>',\n          //     footer: footerContent,\n          //     type: Mooin4Modal.TYPE,\n          //     scrollable: false,\n          //   });\n          //   modal.show();\n          // }\n          //window.console.log(data.show_course_modal);\n          // if (data.show_course_modal) {\n          //   let navdrawerChapter = document.querySelector(\n          //     `[data-key=\"${data.chapter_id}\"]`\n          //   );\n          //   navdrawerChapter.classList.add(\"completed\");\n          //   const modal = await ModalFactory.create({\n          //     title: \"Kurs vollständig bearbeitet\",\n          //     body: '<p>Du hast alle Lektionen in diesem Kurs bearbeitet!</p><i class=\"bi bi-mortarboard-fill\"></i>',\n          //     footer:\n          //       '<button type=\"button\" class=\"mooin4-btn mooin4-btn-special\"'+\n          //        'data-action=\"hide\">Schließen<i class=\"bi bi-x-circle-fill\"></i></button>',\n          //     type: Mooin4Modal.TYPE,\n          //     scrollable: false,\n          //   });\n          //   modal.show();\n          // }\n        })\n        .fail();\n    }\n  });\n};\n"],"names":["Selectors","buttonClicked","init","section_id","isLastSectionOfChapter","courseCompletedAlready","ModalFactory","Mooin4Modal","TYPE","title","body","footer","type","scrollable","create","show","progressbar","document","getElementById","percentageText","navdrawerSection","querySelector","addEventListener","e","target","closest","Ajax","call","methodname","args","Number","isActivity","course_already_completed","chapter_already_completed","done","data","textContent","classList","add","disabled","style","width","innerText","message","action","modal","window","postMessage","fail"],"mappings":"stCAQMA,kBACK,CACPC,cACE,mEAIOC,uDAAO,4OAClBC,gBAAAA,WACAC,4BAAAA,uBACAC,4BAAAA,wBAEID,oEACkBE,yCACL,mBACX,sCACA,6EAIO,mBAAU,gCAAiC,wEADlD,6CAEA,8CAEA,oGAEO,mBAAU,QAAS,6HAC1B,4DACIC,qBAAYC,oBAblBC,mBAIAC,kBAIAC,oBAKAC,kBACAC,YAAY,kCAfmBC,+DAiB3BC,eAGJC,YAAcC,SAASC,qCAA8Bf,aACrDgB,eAAiBF,SAASC,2CACPf,aAEnBiB,iBAAmBH,SAASI,mCAA4BlB,kBAE5Dc,SAASK,iBAAiB,SAAS,SAACC,aAC9BA,EAAEC,OAAOC,QAAQzB,kBAAkBC,gBACtByB,cAAKC,KAAK,CACvB,CACEC,WAAY,wCACZC,KAAM,CACJ1B,WAAY2B,OAAO3B,YACnB4B,YAAY,EACZC,yBAA0B3B,uBAC1B4B,2BAA2B,MAIxB,GACNC,uDAAK,iBAAgBC,+IACS,mBAAU,YAAa,wBAApDZ,EAAEC,OAAOY,0BAETb,EAAEC,OAAOa,UAAUC,IAAI,aACvBlB,iBAAiBiB,UAAUC,IAAI,aAC/Bf,EAAEC,OAAOe,UAAW,EACpBvB,YAAYwB,MAAMC,MAAQ,OAC1BtB,eAAeuB,UAAY,QAEvBC,QAAU,CACZC,OAAQ,YACRC,MAAO,CAAEV,KAAAA,OAEXW,OAAOC,YAAYJ,QAAS,kHAkD7BK"}