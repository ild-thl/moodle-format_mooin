{"version":3,"file":"section_completion_handler.min.js","sources":["../src/section_completion_handler.js"],"sourcesContent":["//import {call as fetchMany} from 'core/ajax';\n\n// export const check_completion_status = (\n//   course_id,\n//   section_id,\n// ) => fetchMany([{\n//   methodname: 'format_mooin4_check_completion_status',\n//   args: {\n//     course_id,\n//     section_id,\n//   },\n// }])[0];\n\nconst Selectors = {\n  actions: {\n    buttonClicked:\n      '[data-action=\"format_mooin4/section_completion_handler-button\"]',\n  },\n};\n\nexport const init = ({section_id, course_id}) => {\n  var xhr = new XMLHttpRequest();\n  xhr.onreadystatechange = () => {\n    if (xhr.readyState == 4) {\n      if (xhr.status == 200) {\n        var result = JSON.parse(xhr.response);\n        if (result) {\n            window.console.log(result.completed);\n        }\n      }\n    }\n  };\n\n  let progressbar = document.getElementById(`mooin4ection${section_id}`);\n  let percentageText = document.getElementById(`mooin4ection-text-${section_id}`);\n  let navdrawerSection = document.querySelector(`[data-key=\"${section_id}\"]`);\n\n  document.addEventListener(\"click\", (e) => {\n    if (e.target.closest(Selectors.actions.buttonClicked)) {\n      var formData = new FormData();\n      formData.append(\"section\", section_id);\n      formData.append(\"course_id\", course_id);\n      xhr.open(\"POST\", \"format/mooin4/complete_section.php\", true);\n\n      xhr.send(formData);\n\n      e.target.textContent = \"Seite gelesen\";\n\n      e.target.classList.add('completed');\n      navdrawerSection.classList.add('completed');\n      e.target.disabled = true;\n      progressbar.style.width = \"100%\";\n      percentageText.innerText = \"100%\";\n    }\n  });\n\n  // let completeBtn = document.getElementById(`btn_comp`);\n  // let sectionNumber;\n  // window.console.log(section);\n  // completeBtn.addEventListener(() => {\n  //   sectionNumber = section;\n  //   window.console.log(sectionNumber);\n  // });\n};\n"],"names":["Selectors","buttonClicked","section_id","course_id","xhr","XMLHttpRequest","onreadystatechange","readyState","status","result","JSON","parse","response","window","console","log","completed","progressbar","document","getElementById","percentageText","navdrawerSection","querySelector","addEventListener","e","target","closest","formData","FormData","append","open","send","textContent","classList","add","disabled","style","width","innerText"],"mappings":"kKAaMA,kBACK,CACPC,cACE,gFAIc,mBAAEC,gBAAAA,WAAYC,eAAAA,UAC5BC,IAAM,IAAIC,eACdD,IAAIE,mBAAqB,cACD,GAAlBF,IAAIG,YACY,KAAdH,IAAII,OAAe,KACjBC,OAASC,KAAKC,MAAMP,IAAIQ,UACxBH,QACAI,OAAOC,QAAQC,IAAIN,OAAOO,iBAMhCC,YAAcC,SAASC,qCAA8BjB,aACrDkB,eAAiBF,SAASC,2CAAoCjB,aAC9DmB,iBAAmBH,SAASI,mCAA4BpB,kBAE5DgB,SAASK,iBAAiB,SAAS,SAACC,MAC9BA,EAAEC,OAAOC,QAAQ1B,kBAAkBC,eAAgB,KACjD0B,SAAW,IAAIC,SACnBD,SAASE,OAAO,UAAW3B,YAC3ByB,SAASE,OAAO,YAAa1B,WAC7BC,IAAI0B,KAAK,OAAQ,qCAAqC,GAEtD1B,IAAI2B,KAAKJ,UAETH,EAAEC,OAAOO,YAAc,gBAEvBR,EAAEC,OAAOQ,UAAUC,IAAI,aACvBb,iBAAiBY,UAAUC,IAAI,aAC/BV,EAAEC,OAAOU,UAAW,EACpBlB,YAAYmB,MAAMC,MAAQ,OAC1BjB,eAAekB,UAAY"}