{"version":3,"file":"section_completion_handler.min.js","sources":["../src/section_completion_handler.js"],"sourcesContent":["import Ajax from \"core/ajax\";\nimport Notification from \"core/notification\";\nimport { get_string as getString } from \"core/str\";\nimport ModalFactory from \"core/modal_factory\";\nimport Mooin4Modal from \"format_mooin4/mooin4Modal\";\nimport Templates from \"core/templates\";\nimport { relativeUrl } from \"core/url\";\n\nconst Selectors = {\n  actions: {\n    buttonClicked:\n      '[data-action=\"format_mooin4/section_completion_handler-button\"]',\n  },\n};\n\nexport const init = async ({ section_id, isLastSectionOfChapter })  => {\n  if (isLastSectionOfChapter) {\n    const modal = await ModalFactory.create({\n      title: \"Kapitelende erreicht\",\n      body: '<p>Du bist in der letzten Lektion dieses Kapitels angekommen!</p><i class=\"bi bi-star\"></i>',\n      footer: '<button type=\"button\" class=\"mooin4-btn mooin4-btn-primary\"'+\n      'data-action=\"hide\">Schließen<i class=\"bi bi-x-circle-fill\"></i></button>',\n      type: Mooin4Modal.TYPE,\n      scrollable: false,\n    });\n    modal.show();\n  }\n\n\n  let progressbar = document.getElementById(`mooin4ection${section_id}`);\n  let percentageText = document.getElementById(\n    `mooin4ection-text-${section_id}`\n  );\n  let navdrawerSection = document.querySelector(`[data-key=\"${section_id}\"]`);\n\n  document.addEventListener(\"click\", (e) => {\n    if (e.target.closest(Selectors.actions.buttonClicked)) {\n      var promises = Ajax.call([\n        {\n          methodname: \"format_mooin4_check_completion_status\",\n          args: { section_id: Number(section_id), isActivity: false },\n        },\n      ]);\n      promises[0]\n        .done(async function (data) {\n          e.target.textContent = await getString(\"page_read\", \"format_mooin4\");\n\n          e.target.classList.add(\"completed\");\n          navdrawerSection.classList.add(\"completed\");\n          e.target.disabled = true;\n          progressbar.style.width = \"100%\";\n          percentageText.innerText = \"100%\" + \" \";\n\n          if (data.show_chapter_modal) {\n            let navdrawerChapter = document.querySelector(\n              `[data-key=\"${data.chapter_id}\"]`\n            );\n            navdrawerChapter.classList.add(\"completed\");\n            var footerContent = \"\";\n            if (data.next_chapter < 0) {\n               footerContent =\n                '<button type=\"button\" class=\"mooin4-btn mooin4-btn-special\"' +\n                 'data-action=\"hide\">Schließen<i class=\"bi bi-x-circle-fill\"></i></button>';\n            } else {\n               footerContent =\n                '<button type=\"button\" class=\"mooin4-btn mooin4-btn-special\"' +\n                 'data-action=\"hide\">Schließen<i class=\"bi bi-x-circle-fill\"></i></button>' +\n                '<a href=\"' +\n                relativeUrl(\"/course/view.php\", {\n                  id: data.course_id,\n                  section: data.next_chapter,\n                }) +\n                '\" class=\"mooin4-btn mooin4-btn-primary\">Nächstes Kapitel</a>';\n            }\n            const modal = await ModalFactory.create({\n              title: \"Kapitel vollständig bearbeitet\",\n              body: '<p>Du hast alle Lektionen in diesem Kapitel bearbeitet!</p><i class=\"bi bi-check-circle\"></i>',\n              footer: footerContent,\n              type: Mooin4Modal.TYPE,\n              scrollable: false,\n            });\n            modal.show();\n          }\n          window.console.log(data.show_course_modal);\n          if (data.show_course_modal) {\n            let navdrawerChapter = document.querySelector(\n              `[data-key=\"${data.chapter_id}\"]`\n            );\n            navdrawerChapter.classList.add(\"completed\");\n            const modal = await ModalFactory.create({\n              title: \"Kurs vollständig bearbeitet\",\n              body: '<p>Du hast alle Lektionen in diesem Kurs bearbeitet!</p><i class=\"bi bi-mortarboard-fill\"></i>',\n              footer:\n                '<button type=\"button\" class=\"mooin4-btn mooin4-btn-special\"'+\n                 'data-action=\"hide\">Schließen<i class=\"bi bi-x-circle-fill\"></i></button>',\n              type: Mooin4Modal.TYPE,\n              scrollable: false,\n            });\n            modal.show();\n          }\n        })\n        .fail();\n    }\n  });\n};\n"],"names":["Selectors","buttonClicked","init","section_id","isLastSectionOfChapter","ModalFactory","create","title","body","footer","type","Mooin4Modal","TYPE","scrollable","show","progressbar","document","getElementById","percentageText","navdrawerSection","querySelector","addEventListener","e","target","closest","Ajax","call","methodname","args","Number","isActivity","done","data","textContent","classList","add","disabled","style","width","innerText","show_chapter_modal","chapter_id","footerContent","next_chapter","id","course_id","section","window","console","log","show_course_modal","fail"],"mappings":"stCAQMA,kBACK,CACPC,cACE,mEAIOC,uDAAO,8LAASC,gBAAAA,iBAAYC,uEAEjBC,uBAAaC,OAAO,CACtCC,MAAO,uBACPC,KAAM,8FACNC,OAAQ,sIAERC,KAAMC,qBAAYC,KAClBC,YAAY,0BAERC,cAIJC,YAAcC,SAASC,qCAA8Bd,aACrDe,eAAiBF,SAASC,2CACPd,aAEnBgB,iBAAmBH,SAASI,mCAA4BjB,kBAE5Da,SAASK,iBAAiB,SAAS,SAACC,aAC9BA,EAAEC,OAAOC,QAAQxB,kBAAkBC,gBACtBwB,cAAKC,KAAK,CACvB,CACEC,WAAY,wCACZC,KAAM,CAAEzB,WAAY0B,OAAO1B,YAAa2B,YAAY,MAG/C,GACNC,uDAAK,iBAAgBC,qJACS,mBAAU,YAAa,2BAApDV,EAAEC,OAAOU,0BAETX,EAAEC,OAAOW,UAAUC,IAAI,aACvBhB,iBAAiBe,UAAUC,IAAI,aAC/Bb,EAAEC,OAAOa,UAAW,EACpBrB,YAAYsB,MAAMC,MAAQ,OAC1BpB,eAAeqB,UAAY,SAEvBP,KAAKQ,kDACgBxB,SAASI,mCAChBY,KAAKS,kBAEJP,UAAUC,IAAI,aAC3BO,cAAgB,GAEjBA,cADCV,KAAKW,aAAe,EAEpB,sIAIA,gJAGA,oBAAY,mBAAoB,CAC9BC,GAAIZ,KAAKa,UACTC,QAASd,KAAKW,eAEhB,gFAEgBtC,uBAAaC,OAAO,CACtCC,MAAO,iCACPC,KAAM,gGACNC,OAAQiC,cACRhC,KAAMC,qBAAYC,KAClBC,YAAY,0BAERC,kBAERiC,OAAOC,QAAQC,IAAIjB,KAAKkB,oBACpBlB,KAAKkB,iDACgBlC,SAASI,mCAChBY,KAAKS,kBAEJP,UAAUC,IAAI,8BACX9B,uBAAaC,OAAO,CACtCC,MAAO,8BACPC,KAAM,iGACNC,OACE,sIAEFC,KAAMC,qBAAYC,KAClBC,YAAY,0BAERC,oHAGTqC"}